<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ’¡ çµæ„Ÿåº“ - åˆ›ä½œçµæ„Ÿç®¡ç†</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Noto Sans SC', sans-serif; }
    .card-enter { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .suggestion-section { border-left: 3px solid; }
    .suggestion-title { border-left-color: #f59e0b; }
    .suggestion-content { border-left-color: #8b5cf6; }
    .suggestion-structure { border-left-color: #10b981; }
    .suggestion-style { border-left-color: #ec4899; }
    .reference-item { border-left: 3px solid #3b82f6; }
  </style>
</head>
<body class="bg-gradient-to-br from-violet-50 to-pink-50 min-h-screen">
  <div id="app" class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- å¤´éƒ¨ -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
      <div>
        <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-2">
          <span class="text-4xl">ğŸ’¡</span> çµæ„Ÿåº“
        </h1>
        <p class="text-gray-500 mt-1">è®°å½•åˆ›ä½œçµæ„Ÿï¼ŒAI è¾…åŠ©åˆ›ä½œå»ºè®®</p>
      </div>
      <button onclick="openModal()" class="flex items-center gap-2 bg-gradient-to-r from-violet-500 to-pink-500 text-white px-6 py-3 rounded-xl font-medium hover:shadow-lg transition-all cursor-pointer">
        <span>â•</span> æ·»åŠ çµæ„Ÿ
      </button>
    </div>

    <!-- ç»Ÿè®¡ -->
    <div class="grid grid-cols-3 gap-4 mb-6">
      <div class="bg-white rounded-xl p-4 shadow-sm">
        <div class="text-3xl font-bold text-gray-800" id="stat-total">0</div>
        <div class="text-gray-500 text-sm">æ€»çµæ„Ÿ</div>
      </div>
      <div class="bg-white rounded-xl p-4 shadow-sm">
        <div class="text-3xl font-bold text-orange-500" id="stat-pending">0</div>
        <div class="text-gray-500 text-sm">å¾…åˆ›ä½œ</div>
      </div>
      <div class="bg-white rounded-xl p-4 shadow-sm">
        <div class="text-3xl font-bold text-green-500" id="stat-done">0</div>
        <div class="text-gray-500 text-sm">å·²å‘å¸ƒ</div>
      </div>
    </div>

    <!-- æœç´¢å’Œç­›é€‰ -->
    <div class="bg-white rounded-xl p-4 shadow-sm mb-6">
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1 relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">ğŸ”</span>
          <input type="text" id="search" placeholder="æœç´¢çµæ„Ÿ..." oninput="renderList()" 
            class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-500">
        </div>
      </div>
      
      <div class="flex flex-wrap gap-2 mt-4" id="filters"></div>
    </div>

    <!-- çµæ„Ÿåˆ—è¡¨ -->
    <div id="list" class="grid gap-4"></div>

    <!-- æ•°æ®ç®¡ç† -->
    <div class="mt-8 p-4 bg-gray-50 rounded-xl">
      <div class="flex flex-wrap gap-4 justify-between items-center">
        <span class="text-sm text-gray-500">ğŸ’¾ æ•°æ®å·²ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ° + GitHub</span>
        <div class="flex gap-2">
          <button onclick="syncFromGitHub()" class="px-4 py-2 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-50 cursor-pointer">ğŸ”„ åŒæ­¥ GitHub</button>
          <button onclick="exportData()" class="px-4 py-2 text-sm bg-white border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">å¯¼å‡ºæ•°æ®</button>
          <button onclick="importData()" class="px-4 py-2 text-sm bg-white border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">å¯¼å…¥æ•°æ®</button>
          <input type="file" id="import-file" accept=".json" style="display:none" onchange="handleImport(event)">
        </div>
      </div>
    </div>
  </div>

  <!-- å¼¹çª— -->
  <div id="modal" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white rounded-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto">
      <h2 class="text-xl font-bold mb-4">æ·»åŠ æ–°çµæ„Ÿ</h2>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">çµæ„Ÿå†…å®¹ <span class="text-red-500">*</span></label>
          <textarea id="new-content" rows="3" placeholder="æè¿°ä½ çš„åˆ›ä½œçµæ„Ÿ..." 
            class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-500"></textarea>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">å¹³å°</label>
            <select id="new-platform" class="w-full px-4 py-2 border border-gray-200 rounded-xl">
              <option value="å°çº¢ä¹¦">å°çº¢ä¹¦</option>
              <option value="å¾®ä¿¡">å¾®ä¿¡</option>
              <option value="å¾®åš">å¾®åš</option>
              <option value="å³åˆ»">å³åˆ»</option>
              <option value="Bç«™">Bç«™</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ç±»å‹</label>
            <select id="new-type" class="w-full px-4 py-2 border border-gray-200 rounded-xl">
              <option value="æ–‡å­—">æ–‡å­—</option>
              <option value="è§†é¢‘">è§†é¢‘</option>
            </select>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">é¢˜æ</label>
            <select id="new-subject" class="w-full px-4 py-2 border border-gray-200 rounded-xl">
              <option value="èµ„è®¯">èµ„è®¯</option>
              <option value="æµ‹è¯„">æµ‹è¯„</option>
              <option value="é•¿æ–‡">é•¿æ–‡</option>
              <option value="ä¸ªäººåˆ†äº«">ä¸ªäººåˆ†äº«</option>
              <option value="æ•™ç¨‹">æ•™ç¨‹</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">çŠ¶æ€</label>
            <select id="new-status" class="w-full px-4 py-2 border border-gray-200 rounded-xl">
              <option value="å¾…åˆ›ä½œ">å¾…åˆ›ä½œ</option>
              <option value="è¿›è¡Œä¸­">è¿›è¡Œä¸­</option>
              <option value="å·²å‘å¸ƒ">å·²å‘å¸ƒ</option>
              <option value="å½’æ¡£">å½’æ¡£</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="flex gap-3 mt-6">
        <button onclick="closeModal()" class="flex-1 px-4 py-3 border border-gray-200 rounded-xl hover:bg-gray-50 cursor-pointer">å–æ¶ˆ</button>
        <button onclick="addInspiration()" class="flex-1 px-4 py-3 bg-gradient-to-r from-violet-500 to-pink-500 text-white rounded-xl font-medium cursor-pointer">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <script>
    // GitHub é…ç½®
    const GITHUB_REPO = 'howardrock88/inspiration-tracker';
    const DATA_FILE = 'inspirations.json';
    
    // Token ç®¡ç†
    function getGitHubToken() {
      return localStorage.getItem('github_token') || '';
    }
    
    function setGitHubToken(token) {
      localStorage.setItem('github_token', token);
    }
    
    function checkGitHubToken() {
      const token = getGitHubToken();
      if (!token) {
        const input = prompt('é¦–æ¬¡ä½¿ç”¨ï¼Œè¯·è¾“å…¥ GitHub Tokenï¼š\n\nç”Ÿæˆæ–¹å¼ï¼šhttps://github.com/settings/tokens');
        if (input) {
          setGitHubToken(input);
          return input;
        }
        return null;
      }
      return token;
    }

    // æ•°æ®å­˜å‚¨
    let inspirations = JSON.parse(localStorage.getItem('inspirations') || '[]');

    // ç­›é€‰é…ç½®
    const filters = {
      platform: { label: 'å¹³å°', options: ['å…¨éƒ¨', 'å°çº¢ä¹¦', 'å¾®ä¿¡', 'å¾®åš', 'å³åˆ»', 'Bç«™', 'å…¶ä»–'] },
      type: { label: 'ç±»å‹', options: ['å…¨éƒ¨', 'æ–‡å­—', 'è§†é¢‘'] },
      subject: { label: 'é¢˜æ', options: ['å…¨éƒ¨', 'èµ„è®¯', 'æµ‹è¯„', 'é•¿æ–‡', 'ä¸ªäººåˆ†äº«', 'æ•™ç¨‹'] },
      status: { label: 'çŠ¶æ€', options: ['å…¨éƒ¨', 'å¾…åˆ›ä½œ', 'è¿›è¡Œä¸­', 'å·²å‘å¸ƒ', 'å½’æ¡£'] }
    };

    let currentFilters = { platform: 'å…¨éƒ¨', type: 'å…¨éƒ¨', subject: 'å…¨éƒ¨', status: 'å…¨éƒ¨' };

    // åˆå§‹åŒ–
    function init() {
      renderFilters();
      renderList();
      updateStats();
    }

    // æ¸²æŸ“ç­›é€‰å™¨
    function renderFilters() {
      let html = '';
      for (const [key, config] of Object.entries(filters)) {
        html += `<div class="flex items-center gap-2">
          <span class="text-sm text-gray-500">${config.label}ï¼š</span>
          <select onchange="updateFilter('${key}', this.value)" class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-violet-500 bg-white">
            ${config.options.map(o => `<option value="${o}" ${currentFilters[key] === o ? 'selected' : ''}>${o}</option>`).join('')}
          </select>
        </div>`;
      }
      document.getElementById('filters').innerHTML = html;
    }

    // æ›´æ–°ç­›é€‰
    function updateFilter(key, value) {
      currentFilters[key] = value;
      renderList();
    }

    // ä» GitHub åŒæ­¥ï¼ˆä¿ç•™æœ¬åœ°æ–°å¢çš„ï¼‰
    async function syncFromGitHub() {
      const token = checkGitHubToken();
      if (!token) return;
      
      try {
        const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_REPO}/main/${DATA_FILE}?t=${Date.now()}`);
        if (response.ok) {
          const githubData = await response.json();
          if (Array.isArray(githubData)) {
            const localData = inspirations;
            const githubIds = new Set(githubData.map(i => i.id));
            const newFromLocal = localData.filter(i => !githubIds.has(i.id));
            inspirations = [...githubData, ...newFromLocal];
            localStorage.setItem('inspirations', JSON.stringify(inspirations));
            renderList();
            updateStats();
            console.log('âœ… å·²åŒæ­¥');
          }
        }
      } catch (e) {
        console.log('GitHub åŒæ­¥å¤±è´¥');
      }
    }

    // ä¸Šä¼ åˆ° GitHub
    async function uploadToGitHub() {
      const token = getGitHubToken();
      if (!token) return false;
      
      try {
        const content = JSON.stringify(inspirations, null, 2);
        const encodedContent = btoa(unescape(encodeURIComponent(content)));
        
        // è·å– SHA
        let sha = null;
        try {
          const existingFile = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${DATA_FILE}`, {
            headers: { 'Authorization': `token ${token}` }
          });
          if (existingFile.ok) {
            const data = await existingFile.json();
            sha = data.sha;
          }
        } catch (e) {}
        
        const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${DATA_FILE}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: `Update: ${inspirations.length} æ¡çµæ„Ÿ - ${new Date().toLocaleString('zh-CN')}`,
            content: encodedContent,
            sha: sha
          })
        });
        
        return response.ok;
      } catch (e) {
        console.log('GitHub ä¸Šä¼ å¤±è´¥:', e);
        return false;
      }
    }

    // æ¸²æŸ“åˆ—è¡¨
    function renderList() {
      const search = document.getElementById('search').value.toLowerCase();
      const list = document.getElementById('list');
      
      const filtered = inspirations.filter(item => {
        const matchesSearch = item.content.toLowerCase().includes(search);
        const matchesPlatform = currentFilters.platform === 'å…¨éƒ¨' || item.platform === currentFilters.platform;
        const matchesType = currentFilters.type === 'å…¨éƒ¨' || item.type === currentFilters.type;
        const matchesSubject = currentFilters.subject === 'å…¨éƒ¨' || item.subject === currentFilters.subject;
        const matchesStatus = currentFilters.status === 'å…¨éƒ¨' || item.status === currentFilters.status;
        return matchesSearch && matchesPlatform && matchesType && matchesSubject && matchesStatus;
      });

      if (filtered.length === 0) {
        list.innerHTML = `
          <div class="text-center py-12 text-gray-400">
            <div class="text-6xl mb-4">ğŸ’¡</div>
            <p>è¿˜æ²¡æœ‰çµæ„Ÿï¼Œå¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ä¸ªæƒ³æ³•å§ï¼</p>
          </div>`;
        return;
      }

      list.innerHTML = filtered.map(item => `
        <div class="bg-white rounded-2xl shadow-sm overflow-hidden hover:shadow-md transition-shadow card-enter">
          <div class="p-5">
            <div class="flex flex-wrap gap-2 mb-3">
              <span class="px-3 py-1 bg-pink-100 text-pink-700 rounded-full text-sm font-medium">${item.platform}</span>
              <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">${item.type}</span>
              <span class="px-3 py-1 bg-violet-100 text-violet-700 rounded-full text-sm font-medium">${item.subject}</span>
              <span class="px-3 py-1 rounded-full text-sm font-medium ${item.status === 'å¾…åˆ›ä½œ' ? 'bg-orange-100 text-orange-700' : item.status === 'è¿›è¡Œä¸­' ? 'bg-blue-100 text-blue-700' : item.status === 'å·²å‘å¸ƒ' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'}">${item.status}</span>
            </div>
            <p class="text-gray-800 text-lg mb-3">${item.content}</p>
            
            ${item.suggestions ? renderSuggestions(item) : '<div class="text-sm text-gray-400 italic">â³ ç­‰å¾… AI ç”Ÿæˆåˆ›ä½œå»ºè®®...</div>'}
            
            <div class="flex flex-wrap items-center justify-between gap-2 pt-3 border-t border-gray-100">
              <span class="text-sm text-gray-400">${item.createdAt}</span>
              <div class="flex gap-2">
                <select onchange="updateStatus('${item.id}', this.value)" class="px-3 py-1.5 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500 bg-white">
                  <option value="å¾…åˆ›ä½œ" ${item.status === 'å¾…åˆ›ä½œ' ? 'selected' : ''}>å¾…åˆ›ä½œ</option>
                  <option value="è¿›è¡Œä¸­" ${item.status === 'è¿›è¡Œä¸­' ? 'selected' : ''}>è¿›è¡Œä¸­</option>
                  <option value="å·²å‘å¸ƒ" ${item.status === 'å·²å‘å¸ƒ' ? 'selected' : ''}>å·²å‘å¸ƒ</option>
                  <option value="å½’æ¡£" ${item.status === 'å½’æ¡£' ? 'selected' : ''}>å½’æ¡£</option>
                </select>
                <button onclick="deleteInspiration('${item.id}')" class="px-3 py-1.5 text-red-500 hover:bg-red-50 rounded-lg text-sm transition-colors cursor-pointer">ğŸ—‘ï¸ åˆ é™¤</button>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // æ¸²æŸ“å»ºè®®
    function renderSuggestions(item) {
      const s = item.suggestions;
      if (!s || !s.titles) return '';
      
      let html = `
        <div class="bg-gradient-to-r from-amber-50 to-violet-50 rounded-xl p-4 mb-3">
          <div class="flex items-center gap-2 mb-3">
            <span class="text-lg">ğŸ’¡</span>
            <span class="font-bold text-gray-700">AI åˆ›ä½œå»ºè®®</span>
            <span class="text-xs text-gray-400 ml-auto">${item.platform} Â· ${item.type}</span>
          </div>
          
          <div class="grid gap-3">
            <div class="suggestion-section suggestion-title pl-3">
              <div class="text-xs font-medium text-amber-600 mb-1">ğŸ“ æ ‡é¢˜å»ºè®®</div>
              <div class="text-sm text-gray-700 space-y-1">${(s.titles || []).map(t => `<div>â€¢ ${t}</div>`).join('')}</div>
            </div>
            
            <div class="suggestion-section suggestion-content pl-3">
              <div class="text-xs font-medium text-violet-600 mb-1">ğŸ¯ é€‰é¢˜è§’åº¦</div>
              <div class="text-sm text-gray-700 space-y-1">${(s.angles || []).map(a => `<div>â€¢ ${a}</div>`).join('')}</div>
            </div>
            
            <div class="suggestion-section suggestion-structure pl-3">
              <div class="text-xs font-medium text-emerald-600 mb-1">ğŸ“ å†…å®¹ç»“æ„</div>
              <div class="text-sm text-gray-700 space-y-1">${(s.structure || []).map(st => `<div>â€¢ ${st}</div>`).join('')}</div>
            </div>
            
            <div class="suggestion-section suggestion-style pl-3">
              <div class="text-xs font-medium text-pink-600 mb-1">âœ¨ å¹³å°é€‚é…</div>
              <div class="text-sm text-gray-700 space-y-1">
                <div><strong>ç¯‡å¹…ï¼š</strong>${s.platform?.length || 'è‡ªç”±'}</div>
                <div><strong>é£æ ¼ï¼š</strong>${s.platform?.style || 'ç¬¦åˆå¹³å°è°ƒæ€§'}</div>
              </div>
            </div>`;
      
      if (s.referenceWorks && s.referenceWorks.length > 0) {
        html += `
            <div class="mt-2">
              <div class="text-xs font-medium text-blue-600 mb-2">ğŸ“– å‚è€ƒä½œå“</div>
              ${s.referenceWorks.map((ref, idx) => `
                <div class="reference-item pl-3 py-2 mb-2 bg-white/50 rounded-r-lg">
                  <a href="${ref.url}" target="_blank" class="text-blue-600 font-medium hover:underline">${ref.title}</a>
                  <div class="text-xs text-gray-500 mt-1">${ref.desc}</div>
                  <div class="text-xs text-gray-400 mt-1">${ref.stats || ''}</div>
                </div>
              `).join('')}
            </div>`;
      }
      
      html += `</div></div>`;
      return html;
    }

    // æ›´æ–°ç»Ÿè®¡
    function updateStats() {
      document.getElementById('stat-total').textContent = inspirations.length;
      document.getElementById('stat-pending').textContent = inspirations.filter(i => i.status === 'å¾…åˆ›ä½œ').length;
      document.getElementById('stat-done').textContent = inspirations.filter(i => i.status === 'å·²å‘å¸ƒ').length;
    }

    // æ·»åŠ çµæ„Ÿ
    async function addInspiration() {
      const content = document.getElementById('new-content').value.trim();
      if (!content) return;
      
      const platform = document.getElementById('new-platform').value;
      const type = document.getElementById('new-type').value;
      const subject = document.getElementById('new-subject').value;
      const status = document.getElementById('new-status').value;
      
      const id = Date.now().toString();
      
      // ä¿å­˜æ—¶ä¸ç”Ÿæˆå»ºè®®ï¼Œç”± Agent åç»­è‡ªåŠ¨ç”Ÿæˆ
      const item = { 
        id, 
        content, 
        platform, 
        type, 
        subject, 
        status, 
        suggestions: null, 
        createdAt: new Date().toLocaleString('zh-CN') 
      };
      
      inspirations.unshift(item);
      localStorage.setItem('inspirations', JSON.stringify(inspirations));
      
      closeModal();
      renderList();
      updateStats();
      
      // è‡ªåŠ¨åŒæ­¥åˆ° GitHub
      await uploadToGitHub();
    }

    // æ›´æ–°çŠ¶æ€
    async function updateStatus(id, status) {
      const item = inspirations.find(i => i.id === id);
      if (item) {
        item.status = status;
        localStorage.setItem('inspirations', JSON.stringify(inspirations));
        updateStats();
        await uploadToGitHub();
      }
    }

    // åˆ é™¤çµæ„Ÿ
    async function deleteInspiration(id) {
      if (confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªçµæ„Ÿå—ï¼Ÿ')) {
        inspirations = inspirations.filter(i => i.id !== id);
        localStorage.setItem('inspirations', JSON.stringify(inspirations));
        renderList();
        updateStats();
        // åŒæ­¥åˆ é™¤åˆ° GitHub
        await uploadToGitHub();
      }
    }

    // å¼¹çª—
    function openModal() {
      document.getElementById('modal').classList.remove('hidden');
      document.getElementById('new-content').value = '';
    }
    
    function closeModal() {
      document.getElementById('modal').classList.add('hidden');
    }

    // å¯¼å‡º
    function exportData() {
      const data = JSON.stringify(inspirations, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `çµæ„Ÿåº“-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
    }

    // å¯¼å…¥
    function importData() {
      document.getElementById('import-file').click();
    }
    
    function handleImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          if (Array.isArray(data)) {
            inspirations = data;
            localStorage.setItem('inspirations', JSON.stringify(inspirations));
            renderList();
            updateStats();
            alert('å¯¼å…¥æˆåŠŸï¼');
          }
        } catch (err) {
          alert('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼é”™è¯¯');
        }
      };
      reader.readAsText(file);
    }

    // å¯åŠ¨
    init();
  </script>
</body>
</html>